<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Compile Shadowsocks-libev in CentOS7 · Leyar's Notebook</title><meta name="description" content="Compile Shadowsocks-libev in CentOS7 - Leyar"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/images/favicon.ico"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://www.leyar.me/atom.xml" title="Leyar's Notebook"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/iLeyar" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Compile Shadowsocks-libev in CentOS7</h1><div class="post-info">2017年2月13日</div><div class="post-content"><h2 id="Prerequisites"><a href="#Prerequisites" class="headerlink" title="Prerequisites"></a>Prerequisites</h2><h3 id="Build-and-install-with-recent-mbedTLS-and-libsodium"><a href="#Build-and-install-with-recent-mbedTLS-and-libsodium" class="headerlink" title="Build and install with recent mbedTLS and libsodium"></a>Build and install with recent mbedTLS and libsodium</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">export</span> LIBSODIUM_VER=1.0.11</div><div class="line"><span class="built_in">export</span> MBEDTLS_VER=2.4.0</div><div class="line">wget https://github.com/jedisct1/libsodium/releases/download/1.0.11/libsodium-<span class="variable">$LIBSODIUM_VER</span>.tar.gz</div><div class="line">tar xvf libsodium-<span class="variable">$LIBSODIUM_VER</span>.tar.gz</div><div class="line"><span class="built_in">pushd</span> libsodium-<span class="variable">$LIBSODIUM_VER</span></div><div class="line">./configure --prefix=/usr &amp;&amp; make</div><div class="line">sudo make install</div><div class="line"><span class="built_in">popd</span></div><div class="line">wget https://tls.mbed.org/download/mbedtls-<span class="variable">$MBEDTLS_VER</span>-gpl.tgz</div><div class="line">tar xvf mbedtls-<span class="variable">$MBEDTLS_VER</span>-gpl.tgz</div><div class="line"><span class="built_in">pushd</span> mbedtls-<span class="variable">$MBEDTLS_VER</span></div><div class="line">make SHARED=1 CFLAGS=<span class="_">-f</span>PIC</div><div class="line">sudo make DESTDIR=/usr install</div><div class="line"><span class="built_in">popd</span></div></pre></td></tr></table></figure>
<a id="more"></a>
<h3 id="Other"><a href="#Other" class="headerlink" title="Other"></a>Other</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">yum install epel-release -y</div><div class="line">yum install gcc gettext autoconf libtool automake make pcre-devel asciidoc xmlto udns-devel libev-devel -y</div></pre></td></tr></table></figure>
<h3 id="Get-the-latest-source-code"><a href="#Get-the-latest-source-code" class="headerlink" title="Get the latest source code"></a>Get the latest source code</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">git <span class="built_in">clone</span> https://github.com/shadowsocks/shadowsocks-libev.git</div><div class="line"><span class="built_in">cd</span> shadowsocks-libev</div><div class="line">git submodule update --init --recursive</div></pre></td></tr></table></figure>
<h2 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">./autogen.sh &amp;&amp; ./configure &amp;&amp; make</div><div class="line">sudo make install</div></pre></td></tr></table></figure>
<h2 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h2><h3 id="Create-the-configuration-file"><a href="#Create-the-configuration-file" class="headerlink" title="Create the configuration file"></a>Create the configuration file</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mkdir -p /etc/shadowsocks</div><div class="line">vi /etc/shadowsocks/config.json</div></pre></td></tr></table></figure>
<p>Put the following text into the file:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line"> <span class="attr">"server"</span>:<span class="string">"0.0.0.0"</span>,</div><div class="line"> <span class="attr">"server_port"</span>:<span class="number">40002</span>,</div><div class="line"> <span class="attr">"local_address"</span>: <span class="string">"127.0.0.1"</span>,</div><div class="line"> <span class="attr">"local_port"</span>:<span class="number">1080</span>,</div><div class="line"> <span class="attr">"password"</span>:<span class="string">"mypassword"</span>,</div><div class="line"> <span class="attr">"timeout"</span>:<span class="number">300</span>,</div><div class="line"> <span class="attr">"method"</span>:<span class="string">"chacha20"</span>,</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="To-run-with-deamon-in-CentOS7"><a href="#To-run-with-deamon-in-CentOS7" class="headerlink" title="To run with deamon in CentOS7"></a>To run with deamon in CentOS7</h3><p>Create and edit a file:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vi /etc/systemd/system/shadowsocks.service</div></pre></td></tr></table></figure></p>
<p>Add the following text to the file <code>shadowsocks.service</code> :<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">[Unit]</div><div class="line">Description=Shadowsocks</div><div class="line">After=network.target</div><div class="line"></div><div class="line">[Service]</div><div class="line">Type=forking</div><div class="line">PIDFile=/run/shadowsocks/ss.pid</div><div class="line">PermissionsStartOnly=true</div><div class="line">ExecStartPre=/bin/mkdir -p /run/shadowsocks</div><div class="line">ExecStartPre=/bin/chown nobody:nobody /run/shadowsocks</div><div class="line">ExecStart=/usr/local/bin/ss-server -u -c /etc/shadowsocks/config.json -v -f /var/run/shadowsocks/ss.pid</div><div class="line">Restart=on-abort</div><div class="line">User=nobody</div><div class="line">Group=nobody</div><div class="line">UMask=0027</div><div class="line"></div><div class="line">[Install]</div><div class="line">WantedBy=multi-user.target</div></pre></td></tr></table></figure></p>
<p>To run<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">systemctl start shadowsocks</div><div class="line">systemctl <span class="built_in">enable</span> shadowsocks</div></pre></td></tr></table></figure></p>
<p>To stop<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">systemctl stop shadowsocks</div></pre></td></tr></table></figure></p>
<p>Check the log<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">less /var/<span class="built_in">log</span>/messages</div></pre></td></tr></table></figure></p>
<p>You can also use the following command:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">journalctl | grep ss-server</div></pre></td></tr></table></figure></p>
<p>or<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">journalctl -u shadowsocks.service</div></pre></td></tr></table></figure></p>
<p>More usage about <code>journalctl</code></p>
<ul>
<li><a href="http://linoxide.com/linux-how-to/systemd-journalctl-command-logs/" target="_blank" rel="external">How Use Systemd journalctl Command To Manage Logs</a></li>
</ul>
<h2 id="Firewalld"><a href="#Firewalld" class="headerlink" title="Firewalld"></a>Firewalld</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vi /etc/firewalld/services/shadowsocks.xml</div></pre></td></tr></table></figure>
<p>Add the following text:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">service</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">short</span>&gt;</span>shadowsocks<span class="tag">&lt;/<span class="name">short</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>enable shadowsocks.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">port</span> <span class="attr">protocol</span>=<span class="string">"tcp"</span> <span class="attr">port</span>=<span class="string">"39999"</span>/&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">port</span> <span class="attr">protocol</span>=<span class="string">"udp"</span> <span class="attr">port</span>=<span class="string">"39999"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">service</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>Add a firewall policy use the command <code>firewall-cmd</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">firewall-cmd --permanent --zone=public --add-service=shadowsocks</div><div class="line">firewall-cmd --reload</div></pre></td></tr></table></figure></p>
<h2 id="Reference-material"><a href="#Reference-material" class="headerlink" title="Reference material"></a>Reference material</h2><ul>
<li><a href="https://github.com/shadowsocks/shadowsocks-libev" target="_blank" rel="external">Shadowsocks-libev</a></li>
</ul>
<p><em>Last updated: 2017/02/19</em></p>
</div></article></div></main><footer><div class="paginator"><a href="/new-poses-for-scientific-Internet/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'ileyar';
var disqus_identifier = 'Compile-shadowsocks-libev-in-CentOS7/';
var disqus_title = 'Compile Shadowsocks-libev in CentOS7';
var disqus_url = 'http://www.leyar.me/Compile-shadowsocks-libev-in-CentOS7/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//ileyar.disqus.com/count.js" async></script><div class="copyright"><p>© 2011 - 2017 <a href="http://www.leyar.me">Leyar</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-74627504-2",'auto');ga('send','pageview');</script></body></html>