<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Shadowsocks 之安装篇 · Leyar's Notebook</title><meta name="description" content="Shadowsocks 之安装篇 - Leyar"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/images/favicon.ico"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://www.leyar.me/atom.xml" title="Leyar's Notebook"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/iLeyar" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Shadowsocks 之安装篇</h1><div class="post-info">2015年8月1日</div><div class="post-content"><blockquote>
<p>版本： Python 版<br>加密方式： Chacha20<br>推荐安装 <a href="http://www.leyar.me/Compile-shadowsocks-libev-in-CentOS7/">Shadowsocks-libev</a> 版本</p>
</blockquote>
<h2 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h2><h3 id="安装-shadowsocks"><a href="#安装-shadowsocks" class="headerlink" title="安装 shadowsocks"></a>安装 shadowsocks</h3><p>Debian/Ubuntu:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ sudo apt-get install python-pip</div><div class="line">$ sudo pip install shadowsocks</div></pre></td></tr></table></figure></p>
<p>CentOS 7(于2016-2-5更新)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ sudo yum -y update</div><div class="line">$ sudo yum -y install python-pip</div><div class="line">$ pip install --upgrade pip</div><div class="line">$ sudo pip install shadowsocks</div></pre></td></tr></table></figure></p>
<a id="more"></a>
<h3 id="加密"><a href="#加密" class="headerlink" title="加密"></a>加密</h3><p>使用 chacha20 加密，必须安装 M2Crypto 以及libsodium</p>
<h4 id="Installing-M2Crypto"><a href="#Installing-M2Crypto" class="headerlink" title="Installing M2Crypto"></a>Installing M2Crypto</h4><p>Debian/Ubuntu:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">apt-get install python-m2crypto</div></pre></td></tr></table></figure></p>
<p>CentOS:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install m2crypto</div></pre></td></tr></table></figure></p>
<h4 id="Installing-libsodium"><a href="#Installing-libsodium" class="headerlink" title="Installing libsodium"></a>Installing libsodium</h4><p>安装编译工具包 build-essential</p>
<p>Debian/Ubuntu:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install build-essential</div></pre></td></tr></table></figure></p>
<p>CentOS 7:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo yum groupinstall <span class="string">"Development Tools"</span></div><div class="line"><span class="comment">#sudo yum install kernel-devel kernel-headers</span></div></pre></td></tr></table></figure></p>
<p>编译安装 <a href="https://github.com/jedisct1/libsodium" target="_blank" rel="external">libsodium</a>（版本需&gt;= 1.0.0）<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">wget https://github.com/jedisct1/libsodium/releases/download/1.0.8/libsodium-1.0.8.tar.gz</div><div class="line">tar xf libsodium-1.0.8.tar.gz &amp;&amp; <span class="built_in">cd</span> libsodium-1.0.8</div><div class="line">./configure &amp;&amp; make -j2</div><div class="line">sudo make install</div><div class="line">sudo ldconfig</div></pre></td></tr></table></figure></p>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>Create a config file <code>/etc/shadowsocks.json</code> .<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">	<span class="attr">"server"</span>:<span class="string">"0.0.0.0"</span>,</div><div class="line">	<span class="attr">"server_port"</span>:<span class="number">39999</span>,</div><div class="line">	<span class="attr">"password"</span>:<span class="string">"mypassword"</span>,</div><div class="line">	<span class="attr">"timeout"</span>:<span class="number">300</span>,</div><div class="line">	<span class="attr">"method"</span>:<span class="string">"chacha20"</span>,</div><div class="line">	<span class="attr">"fast_open"</span>:<span class="literal">false</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>多用户配置<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">	<span class="attr">"server"</span>:<span class="string">"0.0.0.0"</span>,</div><div class="line">	<span class="attr">"port_password"</span>: &#123;</div><div class="line">		<span class="attr">"38888"</span>:<span class="string">"password1"</span>,</div><div class="line">		<span class="attr">"38889"</span>:<span class="string">"password2"</span>,</div><div class="line">		<span class="attr">"38890"</span>:<span class="string">"password3"</span></div><div class="line">	&#125;,</div><div class="line">	<span class="attr">"timeout"</span>:<span class="number">300</span>,</div><div class="line">	<span class="attr">"method"</span>:<span class="string">"chacha20"</span>,</div><div class="line">	<span class="attr">"fast_open"</span>:<span class="literal">false</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="服务端启动"><a href="#服务端启动" class="headerlink" title="服务端启动"></a>服务端启动</h3><h4 id="常规启动"><a href="#常规启动" class="headerlink" title="常规启动"></a>常规启动</h4><p>To run the config file in the foreground:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ssserver -c /etc/shadowsocks.json</div></pre></td></tr></table></figure></p>
<p>or to run in the background:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ssserver -c /etc/shadowsocks.json <span class="_">-d</span> start</div><div class="line">ssserver -c /etc/shadowsocks.json <span class="_">-d</span> stop	<span class="comment"># 停止 shadowsocks</span></div></pre></td></tr></table></figure></p>
<h4 id="查看日志"><a href="#查看日志" class="headerlink" title="查看日志"></a>查看日志</h4><p>To check the log:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo less /var/<span class="built_in">log</span>/shadowsocks.log</div></pre></td></tr></table></figure></p>
<h4 id="守护程序"><a href="#守护程序" class="headerlink" title="守护程序"></a>守护程序</h4><p>To run with deamon in CentOS7</p>
<p>create file <code>sudo vi /etc/systemd/system/shadowsocks.service</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">[Unit]</div><div class="line">Description=Shadowsocks</div><div class="line">After=network.target</div><div class="line"></div><div class="line">[Service]</div><div class="line">Type=forking</div><div class="line">PIDFile=/run/shadowsocks/server.pid</div><div class="line">PermissionsStartOnly=true</div><div class="line">ExecStartPre=/bin/mkdir -p /run/shadowsocks</div><div class="line">ExecStartPre=/bin/chown root:root /run/shadowsocks</div><div class="line">ExecStart=/usr/bin/ssserver --pid-file /var/run/shadowsocks/server.pid -c /etc/shadowsocks/config.json -d start</div><div class="line">Restart=on-abort</div><div class="line">User=root</div><div class="line">Group=root</div><div class="line">UMask=0027</div><div class="line"></div><div class="line">[Install]</div><div class="line">WantedBy=multi-user.target</div></pre></td></tr></table></figure></p>
<p>give the file permission:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /etc/systemd/system</div><div class="line">chmod 755 shadowsocks.service</div></pre></td></tr></table></figure></p>
<p>to run<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo systemctl start shadowsocks</div><div class="line">sudo systemctl <span class="built_in">enable</span> shadowsocks</div></pre></td></tr></table></figure></p>
<h4 id="Firewalld"><a href="#Firewalld" class="headerlink" title="Firewalld"></a>Firewalld</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">touch /etc/firewalld/services/shadowsocks.xml</div><div class="line">sudo vi /etc/firewalld/services/shadowsocks.xml</div></pre></td></tr></table></figure>
<p>加入如下内容：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">service</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">short</span>&gt;</span>shadowsocks<span class="tag">&lt;/<span class="name">short</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>enable shadowsocks.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">port</span> <span class="attr">protocol</span>=<span class="string">"tcp"</span> <span class="attr">port</span>=<span class="string">"39999"</span>/&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">port</span> <span class="attr">protocol</span>=<span class="string">"udp"</span> <span class="attr">port</span>=<span class="string">"39999"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">service</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>添加防火墙策略<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">firewall-cmd --permanent --zone=public --add-service=shadowsocks</div><div class="line">firewall-cmd --permanent --add-masquerade</div><div class="line">firewall-cmd --reload</div></pre></td></tr></table></figure></p>
<h3 id="客户端启动"><a href="#客户端启动" class="headerlink" title="客户端启动"></a>客户端启动</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sslocal -c /etc/shadowsocks.json</div></pre></td></tr></table></figure>
<h2 id="Optimize"><a href="#Optimize" class="headerlink" title="Optimize"></a>Optimize</h2><p><a href="http://www.leyar.me/optimize-the-shadowsocks/">Shadowsocks 之优化篇</a><br><a href="https://github.com/shadowsocks/shadowsocks/wiki/Optimizing-Shadowsocks" target="_blank" rel="external">Optimizing-Shadowsocks</a><br><a href="https://www.ifshow.com/centos-7-shadowsocks-optimization/" target="_blank" rel="external">CentOS 7 Shadowsocks优化</a></p>
<h2 id="写在后面"><a href="#写在后面" class="headerlink" title="写在后面"></a>写在后面</h2><p>2017-2-19 更新： 推荐编译安装 Shadowsokcs-libev 版本，参考 <a href="http://www.leyar.me/Compile-shadowsocks-libev-in-CentOS7/">Compile Shadowsocks-libev in CentOS7</a></p>
</div></article></div></main><footer><div class="paginator"><a href="/optimize-the-shadowsocks/" class="prev">上一篇</a><a href="/netgear-wndr4300-openwrt-shadowsocks/" class="next">下一篇</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'ileyar';
var disqus_identifier = 'install-the-shadowsocks/';
var disqus_title = 'Shadowsocks 之安装篇';
var disqus_url = 'http://www.leyar.me/install-the-shadowsocks/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//ileyar.disqus.com/count.js" async></script><div class="copyright"><p>© 2011 - 2018 <a href="http://www.leyar.me">Leyar</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-74627504-2",'auto');ga('send','pageview');</script></body></html>