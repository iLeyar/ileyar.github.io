<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Archlinux 安装笔记 · Leyar's Notebook</title><meta name="description" content="Archlinux 安装笔记 - Leyar"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/images/favicon.ico"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://www.leyar.me/atom.xml" title="Leyar's Notebook"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/iLeyar" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Archlinux 安装笔记</h1><div class="post-info">2015年7月28日</div><div class="post-content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>之前就打算将 Ubuntu 换成 Archlinux，但这个计划一直被搁置，直到把双系统中的<br>Windows 换成了 Windows 10，才决定顺便一起将 Ubuntu 也换了。</p>
<p>安装方法参考的官方 <a href="https://wiki.archlinux.org/index.php/Main_page" target="_blank" rel="external">Wiki</a>，<br>完全在文字界面下安装，以便更深入的认识 Linux。这里简单记录下我的安装过程。<br><a id="more"></a></p>
<h2 id="安装准备"><a href="#安装准备" class="headerlink" title="安装准备"></a>安装准备</h2><h3 id="制作-U-盘启动盘"><a href="#制作-U-盘启动盘" class="headerlink" title="制作 U 盘启动盘"></a>制作 U 盘启动盘</h3><p>在官方 Archlinux <a href="https://www.archlinux.org/download/" target="_blank" rel="external">Download Page</a>下载最新的镜像。</p>
<p>使用 <code>dd</code> 制作 U 盘启动盘</p>
<p>先通过 <code>lsblk</code> 查看 U 盘所在驱动器，并确保其处于未挂载状态，然后通过以下命令开始制作启动 U 盘。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dd bs=4M <span class="keyword">if</span>=/path/to/archlinux.iso of=/dev/sdx &amp;&amp; sync</div></pre></td></tr></table></figure>
<p><code>if</code> 后面的参数为 iso 所在的路径，<code>of</code> 后面的参数为 u 盘所在驱动器名，例如<code>/dev/sdf</code></p>
<p>注意：以上方式会格式化 U 盘，需注意做好备份工作。</p>
<p>其他方法参照官方 Wiki：<br><a href="https://wiki.archlinux.org/index.php/USB_flash_installation_media" target="_blank" rel="external">USB flash installation media</a></p>
<p>U 盘制作完成后，重启并启动到 BIOS 模式（也可启动到 UEFI 模式），选择Archlinux 进入系统。之后会看到一个 <code>zsh</code>命令提示符。</p>
<h3 id="网络连接"><a href="#网络连接" class="headerlink" title="网络连接"></a>网络连接</h3><p>正常情况下有线网络会自动连接上。需要设置静态 IP 或者无线网络可以参考官方 Wiki</p>
<h3 id="硬盘分区"><a href="#硬盘分区" class="headerlink" title="硬盘分区"></a>硬盘分区</h3><p>以下分区步骤是通过命令行操作，可以提前用 PE 等其他工具在图形界面下先进行分区。我这里分为 /，/boot,/home,swap 四个分区。</p>
<p>如果已在图形界面分好区，可以直接跳到格式化分区步骤。</p>
<p>以 BIOS/MBR 为例进行分区(双系统请注意填写正确的分区编号)：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">lsblk		<span class="comment"># 查看设备及分区情况</span></div><div class="line">parted /dev/sdx <span class="built_in">print</span>		<span class="comment"># 查看磁盘分区表类型</span></div><div class="line">parted /dev/sdx	<span class="comment"># 打开需要新建分区表的设备,并进入 parted 交互模式</span></div><div class="line">(parted) mkpart primary ext3 1M 300M		<span class="comment"># 创建 /boot 分区</span></div><div class="line">(parted) <span class="built_in">set</span> 1 boot on		<span class="comment"># 设置 /boot 为启动目录</span></div><div class="line">(parted) mkpart primary ext3 300M 20G		<span class="comment"># 20 G `/` 分区</span></div><div class="line">(parted) mkpart primary linux-swap 20G 24G	<span class="comment"># swap 分区</span></div><div class="line">(parted) mkpart primary ext3 24G 100%		<span class="comment"># 剩下的空间给 /home</span></div></pre></td></tr></table></figure>
<p><em>图形分区工具可以选择 <a href="https://wiki.archlinux.org/index.php/GParted" target="_blank" rel="external">GParted</a></em></p>
<h3 id="创建文件系统"><a href="#创建文件系统" class="headerlink" title="创建文件系统"></a>创建文件系统</h3><p>分区之后需要将其格式化为指定的文件系统。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">lsblk /dev/sdx	<span class="comment"># 查看所有分区</span></div><div class="line">mkswap /dev/sdax	<span class="comment"># 格式化 swap 区</span></div><div class="line">swapon /dev/sdax	<span class="comment"># 启用 swap 区</span></div><div class="line">mkfs.ext4 /dev/sdaxy	<span class="comment"># 格式化其他分区为 ext4 文件系统</span></div></pre></td></tr></table></figure></p>
<h3 id="挂载分区"><a href="#挂载分区" class="headerlink" title="挂载分区"></a>挂载分区</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">mount /dev/sdxR /mnt	<span class="comment"># 挂载 `/`（root）分区</span></div><div class="line">mkdir /mnt/boot</div><div class="line">mount /dev/sdxy /mnt/boot	<span class="comment"># 挂载 `/boot` 分区</span></div><div class="line">mkdir /mnt/home</div><div class="line">mount /dev/sdxy /mnt/home	<span class="comment"># 挂载 `/home` 分区</span></div></pre></td></tr></table></figure>
<h3 id="选择安装镜像"><a href="#选择安装镜像" class="headerlink" title="选择安装镜像"></a>选择安装镜像</h3><p>编辑 <code>/etc/pacman.d/mirrorlist</code>，设置安装源。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vi /etc/pacman.d/mirrorlist</div></pre></td></tr></table></figure></p>
<p>通过 <code>/cn</code> 搜索中国的镜像源，去掉前面的注释启用。</p>
<p>这里贴一个使用<a href="https://www.archlinux.org/mirrorlist/" target="_blank" rel="external">镜像列表生成器</a>生成的距离我这边最近的镜像列表。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">##</div><div class="line">## Arch Linux repository mirrorlist</div><div class="line">## Generated on 2015-07-31</div><div class="line">##</div><div class="line"></div><div class="line">## China</div><div class="line">Server = http://mirrors.163.com/archlinux/$repo/os/$arch</div><div class="line">Server = http://mirror.bjtu.edu.cn/archlinux/$repo/os/$arch</div><div class="line">Server = http://mirrors.cqu.edu.cn/archlinux/$repo/os/$arch</div><div class="line">Server = http://mirrors.hust.edu.cn/archlinux/$repo/os/$arch</div><div class="line">Server = http://mirrors.hustunique.com/archlinux/$repo/os/$arch</div><div class="line">Server = http://mirrors.neusoft.edu.cn/archlinux/$repo/os/$arch</div><div class="line">Server = http://mirrors.opencas.cn/archlinux/$repo/os/$arch</div><div class="line">Server = http://run.hit.edu.cn/archlinux/$repo/os/$arch</div><div class="line">Server = http://mirrors.tuna.tsinghua.edu.cn/archlinux/$repo/os/$arch</div><div class="line">Server = http://mirrors.ustc.edu.cn/archlinux/$repo/os/$arch</div><div class="line">Server = http://mirrors.zju.edu.cn/archlinux/$repo/os/$arch</div></pre></td></tr></table></figure></p>
<p>更改镜像源后，使用<code>pacman -Syy</code>强制刷新。</p>
<h2 id="安装系统"><a href="#安装系统" class="headerlink" title="安装系统"></a>安装系统</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pacstrap -i /mnt base base-devel</div></pre></td></tr></table></figure>
<h2 id="生成-fstab-file-system-table"><a href="#生成-fstab-file-system-table" class="headerlink" title="生成 fstab (file system table)"></a>生成 fstab (file system table)</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">genfstab -U -p /mnt &gt;&gt; /mnt/etc/fstab</div><div class="line">vi /mnt/etc/fstabi	<span class="comment"># 检查生成 fstab 是否正确</span></div></pre></td></tr></table></figure>
<h2 id="切换新系统"><a href="#切换新系统" class="headerlink" title="切换新系统"></a>切换新系统</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">arch-chroot /mnt /bin/bash</div></pre></td></tr></table></figure>
<h2 id="配置新系统"><a href="#配置新系统" class="headerlink" title="配置新系统"></a>配置新系统</h2><h3 id="Locale"><a href="#Locale" class="headerlink" title="Locale"></a>Locale</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vi /etc/locale.gen</div></pre></td></tr></table></figure>
<p>去掉以下几项前面的注释“#”<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">en_US.UTF-8 UTF-8</div><div class="line">zh_CN.UTF-8 UTF-8</div><div class="line">zh_TW.UTF-8 UTF-8</div><div class="line">zh_HK.UTF-8 UTF-8</div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">locale-gen		<span class="comment"># 生成 locale 讯息</span></div><div class="line"><span class="built_in">echo</span> LANG=en_US.UTF-8 &gt; /etc/locale.conf		<span class="comment"># 提交本地化选项</span></div></pre></td></tr></table></figure>
<h3 id="时区"><a href="#时区" class="headerlink" title="时区"></a>时区</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ls /usr/share/zoneinfo	<span class="comment">#查看可用时区</span></div><div class="line">ls /usr/share/Asia		<span class="comment">#查看亚洲可用时区</span></div><div class="line">ln <span class="_">-s</span> /usr/share/zoneinfo/Asia/Shanghai /etc/localtime	<span class="comment">#设置时区</span></div></pre></td></tr></table></figure>
<p>注意： 后期当出现时间不准确的问题，可通过强制执行上面的最后一项命令来修正。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</div></pre></td></tr></table></figure></p>
<h3 id="硬件时间"><a href="#硬件时间" class="headerlink" title="硬件时间"></a>硬件时间</h3><p>为了便于统一机器上所有系统的硬件时间模式，可将操作系统时间设置成 UTC时间。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hwclock --systohc --utc	<span class="comment"># 自动生成 /etc/adjtime</span></div></pre></td></tr></table></figure></p>
<p>关于时间问题，还可以参考<a href="https://wiki.archlinux.org/index.php/Time" target="_blank" rel="external">Time</a></p>
<h3 id="设置主机名"><a href="#设置主机名" class="headerlink" title="设置主机名"></a>设置主机名</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">echo</span> *ileyar* &gt; /etc/hostname		<span class="comment"># myhostname 为 ileyar</span></div></pre></td></tr></table></figure>
<p>修改 <code>/etc/hosts</code> 添加新建的主机名<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">#&lt;ip-address&gt;	&lt;hostname.domain.org&gt;	&lt;hostname&gt;</div><div class="line">127.0.0.1	localhost.localdomain	localhost	ileyar</div><div class="line">::1		localhost.localdomain	localhost	ileyar</div></pre></td></tr></table></figure></p>
<h3 id="配置网络"><a href="#配置网络" class="headerlink" title="配置网络"></a>配置网络</h3><p>我这里使用的有线，直接使用 dhcpcd 服务即可。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ip link	<span class="comment">#查看网络接口名</span></div><div class="line">systemctl <span class="built_in">enable</span> dhcpcd@*interface_name*.service	<span class="comment">#interface_name 为网络接口名</span></div></pre></td></tr></table></figure></p>
<p>其他也可以使用 netctl 或者 systemd-networkd 来配置并管理网络。详细操作方法参考官方 Wiki。</p>
<h3 id="设置-Root-密码"><a href="#设置-Root-密码" class="headerlink" title="设置 Root 密码"></a>设置 Root 密码</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">passwd</div></pre></td></tr></table></figure>
<h3 id="安装并配置-bootloader"><a href="#安装并配置-bootloader" class="headerlink" title="安装并配置 bootloader"></a>安装并配置 bootloader</h3><p>这里针对 BIOS 主板使用 GRUB 来进行引导。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">pacman -S grub	<span class="comment"># 安装 grub 包</span></div><div class="line">grub-install --target=i386-pc --recheck /dev/sda</div><div class="line">pacman -S os-prober		<span class="comment"># 检测硬盘上其他已安装系统的程序</span></div><div class="line">grub-mkconfig -o /boot/grub/grub.cfg		<span class="comment"># 自动生成引导项配置</span></div></pre></td></tr></table></figure></p>
<h3 id="卸载分区并重启"><a href="#卸载分区并重启" class="headerlink" title="卸载分区并重启"></a>卸载分区并重启</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">exit</span></div><div class="line">reboot</div></pre></td></tr></table></figure>
<p>拔除 U 盘，通过引导项进入新系统即可。至此基本系统安装完毕。</p>
<h2 id="安装系统后必备操作"><a href="#安装系统后必备操作" class="headerlink" title="安装系统后必备操作"></a>安装系统后必备操作</h2><h4 id="安装-zsh："><a href="#安装-zsh：" class="headerlink" title="安装 zsh："></a>安装 zsh：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pacman -S zsh</div></pre></td></tr></table></figure>
<h4 id="创建新用户并设置用户组"><a href="#创建新用户并设置用户组" class="headerlink" title="创建新用户并设置用户组"></a>创建新用户并设置用户组</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">useradd -m -g users -G audio,video,floppy,network,rfkill,scanner,storage,optical,power,wheel,uucp <span class="_">-s</span> /usr/bin/zsh leyar	<span class="comment"># 新建用户 leyar</span></div><div class="line">passwd leyar		<span class="comment"># 设置用户密码</span></div></pre></td></tr></table></figure>
<p>此时可以切换到新建的用户进行余下的操作了。</p>
<h4 id="安装图形界面"><a href="#安装图形界面" class="headerlink" title="安装图形界面"></a>安装图形界面</h4><h5 id="安装-X-图形服务器："><a href="#安装-X-图形服务器：" class="headerlink" title="安装 X 图形服务器："></a>安装 X 图形服务器：</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo pacman -S xorg-server xorg-xinit</div></pre></td></tr></table></figure>
<h5 id="安装显卡驱动："><a href="#安装显卡驱动：" class="headerlink" title="安装显卡驱动："></a>安装显卡驱动：</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ lspci | grep VGA	<span class="comment"># 查看显卡</span></div><div class="line">$ sudo pacman -Ss xf86-video-ati	<span class="comment"># 查找并安装 ATI 开源驱动</span></div></pre></td></tr></table></figure>
<p>常用开源驱动：</p>
<ul>
<li>NVIDIA: xf86-video-nouveau</li>
<li>Intel: xf86-video-intel</li>
<li>ATI: xf86-video-ati</li>
</ul>
<p>至此可以使用 <code>startx</code> 命令手动启动 X图形界面了。</p>
<h5 id="安装桌面环境"><a href="#安装桌面环境" class="headerlink" title="安装桌面环境"></a>安装桌面环境</h5><h6 id="GNOME"><a href="#GNOME" class="headerlink" title="GNOME"></a>GNOME</h6><p>由于 Xorg 只提供了图形环境的基本框架，用户体验有点差强人意。为了使界面更友好，此时需要安装桌面环境，我这里使用的是 GNOME<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo pacman -S gnome</div></pre></td></tr></table></figure></p>
<p>将以下命令添加到<code>~/.xinitrc</code>，即可从控制台下启动 GNOME.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">exec</span> gnome-session</div></pre></td></tr></table></figure></p>
<p>至此，可通过 <code>startx</code>来启动 GNOME.</p>
<h6 id="GDM"><a href="#GDM" class="headerlink" title="GDM"></a>GDM</h6><ul>
<li>如果想通过图形化登陆，则可以使用登陆管理器来操作，比如 GDM</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ sudo pacman -S gdm		<span class="comment"># 安装 gdm</span></div><div class="line">$ systemctl <span class="built_in">enable</span> gdm		<span class="comment"># 开机启动 gdm.service</span></div><div class="line">$ systemctl <span class="_">-f</span> <span class="built_in">enable</span> graphical.target		<span class="comment"># 当无法进入图形界面时则经此实现</span></div><div class="line">$ systemctl <span class="built_in">enable</span> NetworkManager.service	<span class="comment"># 启动网络管理服务</span></div></pre></td></tr></table></figure>
<h2 id="未完待续"><a href="#未完待续" class="headerlink" title="未完待续"></a>未完待续</h2><p>至此，基本的系统及桌面环境都安装完成，更多的有关程序安装配置等问题，也可以在图形界面浏览器中自行 Google，后续会更新一些我在配置过程中遇到的问题及解决办法。</p>
</div></article></div></main><footer><div class="paginator"><a href="/setting-up-dns-server-on-centos7/" class="prev">PREV</a><a href="/how-to-install-dictionaries-for-goldendict/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'ileyar';
var disqus_identifier = 'installation-of-archlinux/';
var disqus_title = 'Archlinux 安装笔记';
var disqus_url = 'http://www.leyar.me/installation-of-archlinux/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//ileyar.disqus.com/count.js" async></script><div class="copyright"><p>© 2011 - 2018 <a href="http://www.leyar.me">Leyar</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-74627504-2",'auto');ga('send','pageview');</script></body></html>